{% extends "base.html" %}
{% load thumbnail store_currency %}

{% block head %}
	<script type="text/javascript" charset="utf-8">
		$(document).ready(function() {
			$('.add_to_cart').click(function(){
				var frm = $('#frm_add_cart');
				frm.submit();
			});
		});
	</script>	
{% endblock %}

{% block content %}
    <div id="detail">
        <h2>Detalhes do produto</h2>
        <div id="thumb">
            {% thumbnail product.photo "270x270" crop="center" as im %}
    		    <div class="moldura"><img id="imagemDefault" src="{{ im.url }}" width="{{ im.width }}" height="{{ im.height }}"></div>
    		{% endthumbnail %}            
    		{% if product.images.count > 1 %}
    		<ul class="thumbs">
    		{% for image in product.images.all %}
    				<li>
    				{% thumbnail image "50x45" crop="center" as im %}
    				    <a class="alterarFoto" href="{% thumbnail image "270x270" crop="center" as full %}{{ full.url }}{% endthumbnail %}">
    				        <img src="{{ im.url }}" width="{{ im.width }}" height="{{ im.height }}">
    				    </a>
    				{% endthumbnail %}
    				</li>
    		{% endfor %}
    		</ul>
    		<script type="text/javascript" charset="utf-8">
    		  $('.alterarFoto').click(function(){
    		      var link = $(this).attr('href');
    		      $('#imagemDefault').attr('src', link);
    		      return false;
      		  });
    		</script>
    		{% endif %}
        </div>
        <form action="{% url add-to-cart  %}" method="post" accept-charset="utf-8">
            {% csrf_token %}
            <input type="hidden" name="product" value="{{product.pk}}"  />
            <div>
                <h3>{{product.title}}</h3>
                <div>
                    {{product.description|striptags|truncatewords:50}}
                    <a href="#details">detalhes</a>
                </div>
            </div>
            <div id="price">
                <label>Pre&ccedil;o</label>
                <div>
                    <strong class="price">{{product.price|currency}}</strong>
                </div>
            </div>
            {% if product.variations.count > 1 %}
                <select name="variation">
                    {% for variation in product.variations.all  %}
                        <option value="{{variation.pk}}">{{variation}}</option>
                    {% endfor %}
                </select>
            {% else %} 
                {% for variation in product.variations.all  %}
                    <input type="hidden" name="variation" value="{{variation.pk}}" />    
                {% endfor %}            
            {% endif %}

            <div class="buttons">
                <button type="submit" class="button blue">Adicionar a sacola</button>
            </div>            
        </form>
        <div class="description"><a name="details">{{product.description|safe}}</a></div>
    </div>
{% endblock %}